<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Orderlla - Customer Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <meta name="customer_name" content="{{ customer_name }}">
    <meta name="customer_address" content="{{ customer_address }}">
    <meta name="customer_contact" content="{{ customer_contact }}">
</head>
<body class="dashboard-page">

    <div class="sidebar">
        <h1 class="logo">Orderlla</h1>
        <ul>
            <li id="homeBtn" class="active">🏠 Home</li>
            <li id="ordersBtn">🚞 Order History</li>
        </ul>
        <div style="flex-grow:1;"></div>
        <a href="{{ url_for('logout') }}" style="text-decoration:none; color:inherit;">
            <div class="logout" id="logoutBtn">🚪 Logout</div>
        </a>
    </div>

    <div class="main">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages-customer">
                    {% for category, message in messages %}
                        <div class="flash flash-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div id="welcomeHeader">
            <h2>Welcome to Orderlla Store</h2>
        </div>

        <div id="productsSection" class="products"></div>

        <div id="orderHistorySection" class="hidden">
            <h3>Your Orders</h3>
            <div id="orderHistoryList">
            </div>
        </div>
    </div>

    <div class="cartIcon">
        🛒 <span id="cartCount">0</span>
    </div>

    <div id="cartOverlay" class="hidden">
        <div class="cartContent">
            <h3>Your Cart</h3>
            <div id="cartItems"></div>
            <div id="cartTotal"></div>
            <div id="placeOrderSection"></div>
            <button id="closeCart">Close</button>
        </div>
    </div>

    <div id="confirmCancelModal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:none; align-items:center; justify-content:center;">
        <div style="background:#fff; color:#000; padding:20px; border-radius:8px; text-align:center; max-width:300px;">
            <p style="margin-bottom: 20px;">Are you sure you want to cancel this order?</p>
            <button id="cancelCancelBtn" style="margin-right:10px; padding: 5px 15px;">No, Go Back</button>
            <button id="confirmCancelBtn" style="background:#FFD700; padding: 5px 15px;">Yes, Cancel</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/customer_dashboard.js') }}"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const homeBtn = document.getElementById('homeBtn');
            const ordersBtn = document.getElementById('ordersBtn');
            const productsSection = document.getElementById('productsSection');
            const orderHistorySection = document.getElementById('orderHistorySection');

            homeBtn.addEventListener('click', function () {
                homeBtn.classList.add('active');
                ordersBtn.classList.remove('active');
                productsSection.classList.remove('hidden');
                if(orderHistorySection) orderHistorySection.classList.add('hidden');
            });

            ordersBtn.addEventListener('click', function () {
                ordersBtn.classList.add('active');
                homeBtn.classList.remove('active');
                productsSection.classList.add('hidden');
                if(orderHistorySection) orderHistorySection.classList.remove('hidden');
            });
            
            if (window.location.hash === '#orders') {
                ordersBtn.click();
            }
        });

        const customerFlash = document.querySelector('.flash-messages-customer');
        if (customerFlash) {
            setTimeout(() => {
                customerFlash.classList.add('flash-fade-out');
            }, 5000);
        }
    </script>
</body>
</html>